<html>
  <head>

  </head>
  <body>
    <div id="popularPosts">

    </div>
    
    
    <script type="text/javascript">
    var maxDataPoint = 0;
    var graphDataNames = [];
    var graphData = [];
    function storeData(obj) {
      for (var i=0; i < 5; i++) {
        var regex = /\/apis\/ajaxsearch\/(.*)/;
        var relaURL = obj.value.items[i].Key.match(regex)[1];
        var pageViews = obj.value.items[i].Cell[0].Primary;
        
        
        pageViews = parseFloat(pageViews.replace(',',''));
        if(parseFloat(pageViews) > maxDataPoint) {
          maxDataPoint = pageViews;
        }
        graphDataNames.unshift(relaURL);
		console.log(pageViews);
        graphData.push(pageViews);
      }
    }
    
    function setMaxPoint() {
      var numDivisions = 0;
      while(maxDataPoint > 100) {
        maxDataPoint = maxDataPoint / 10;
        numDivisions++;
      }
      maxDataPoint = Math.floor((maxDataPoint+1));
      while(numDivisions > 0) {
        maxDataPoint = maxDataPoint * (10);
        numDivisions--;
      }
    }
    
    function setDataPoints() {
      for (var i=0; i < graphData.length; i++) {
        graphData[i] = Math.floor(100*graphData[i] / maxDataPoint);
      }
      return(graphData);      
    }
    
    function topcontentCallback(obj) { 

      

      var graphData = storeData(obj);
      setMaxPoint();
      graphData = setDataPoints();
      console.log(graphData);
      console.log(graphDataNames);
      
      
      console.log(maxDataPoint);
      var graph = document.createElement('img');
      graph.src = "http://www.google.com/chart?cht=bhs&chs=500x160&chd=t:"+graphData.join(',')+"&chco=3072F3&chls=1,3.75,1&chxt=x,y&chxl=1:|"+graphDataNames.join('|')+"&chxr=0,0,"+maxDataPoint+"&chtt=Top+Ranked+AJAX+Search+Pages&chbh=20,2&chg=20,5,5,4";
      console.log(graph.src);
      document.getElementById("popularPosts").appendChild(graph);
      
      
      
    }


	/**
	 * Synchronously load the XML document at the specified URL and
	 * return it as a Document object
	 */
	XML.load = function(url) {
	    // Create a new document with the previously defined function
	    var xmldoc = XML.newDocument();
	    xmldoc.async = false;  // We want to load synchronously
	    xmldoc.load(url);      // Load and parse
	    return xmldoc;         // Return the document
	};


	/**
	 * Create a new Document object. If no arguments are specified,
	 * the document will be empty. If a root tag is specified, the document
	 * will contain that single root tag. If the root tag has a namespace
	 * prefix, the second argument must specify the URL that identifies the
	 * namespace.
	 */
	XML.newDocument = function(rootTagName, namespaceURL) {
	  if (!rootTagName) rootTagName = "";
	  if (!namespaceURL) namespaceURL = "";
	  if (document.implementation && document.implementation.createDocument) {
	    // This is the W3C standard way to do it
	    return document.implementation.createDocument(namespaceURL, rootTagName, null);
	  }
	  else { // This is the IE way to do it
	    // Create an empty document as an ActiveX object
	    // If there is no root element, this is all we have to do
	    var doc = new ActiveXObject("MSXML2.DOMDocument");
	    // If there is a root tag, initialize the document
	    if (rootTagName) {
	      // Look for a namespace prefix
	      var prefix = "";
	      var tagname = rootTagName;
	      var p = rootTagName.indexOf(':');
	      if (p != -1) {
	        prefix = rootTagName.substring(0, p);
	        tagname = rootTagName.substring(p+1);
	      }
	      // If we have a namespace, we must have a namespace prefix
	      // If we don't have a namespace, we discard any prefix
	      if (namespaceURL) {
	        if (!prefix) prefix = "a0"; // What Firefox uses
	      }
	      else prefix = "";
	      // Create the root element (with optional namespace) as a
	      // string of text
	      var text = "<" + (prefix?(prefix+":"):"") +  tagname +
	          (namespaceURL
	           ?(" xmlns:" + prefix + '="' + namespaceURL +'"')
	           :"") +
	          "/>";
	      // And parse that text into the empty document
	      doc.loadXML(text);
	    }
	    return doc;
	  }
	};


	/**
	 * Parse the XML document contained in the string argument and return
	 * a Document object that represents it.
	 */
	XML.parse = function(text) {
	    if (typeof DOMParser != "undefined") {
	        // Mozilla, Firefox, and related browsers
	        return (new DOMParser()).parseFromString(text, "application/xml");
	    }
	    else if (typeof ActiveXObject != "undefined") {
	        // Internet Explorer.
	        var doc = XML.newDocument();  // Create an empty document
	        doc.loadXML(text);            // Parse text into it
	        return doc;                   // Return it
	    }
	    else {
	        // As a last resort, try loading the document from a data: URL
	        // This is supposed to work in Safari. Thanks to Manos Batsis and
	        // his Sarissa library (sarissa.sourceforge.net) for this technique.
	        var url = "data:text/xml;charset=utf-8," + encodeURIComponent(text);
	        var request = new XMLHttpRequest();
	        request.open("GET", url, false);
	        request.send(null);
	        return request.responseXML;
	    }
	};

	var xmldoc = XML.load('http://groups.google.com/group/ajax-search-top-pages/attach/453867cde01d276b/Analytics_code.google.com_20080220_(%5BAJAX_ANALYTICS%5D).xml?part=2');
	var parsedXML = XML.parse(xmldoc);
	console.log(parsedXML);
    </script>

    <script type="text/javascript" src="http://pipes.yahoo.com/pipes/pipe.run?_id=641d127f63df1a29127d53385132782d&_render=json&_callback=topcontentCallback"></script>
  </body>
</html>



